# API 约定

## login

**Des: **第一次登陆

**URL:** `/login`

其他待定，对微信登陆流程还不是太了解。。

下述接口中如果有要求携带登陆信息的先暂时忽略吧。。。



## bind

**Des: **设置用户的学号、姓名、班级

**URL: **`/bind`

**Method: **POST

**Login?: **True

**请求参数：**Json Object

| 属性  | 类型   | 必填 | 说明                                |
| ----- | ------ | ---- | ----------------------------------- |
| id    | string | 是   | 学号                                |
| name  | string | 是   | 姓名                                |
| clazz | string | 是   | 班级，满足如下正则：`^未央-.+\d\d$` |

 **返回值：**Json Object，其中包含属性：

| 属性   | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | int    | 错误码   |
| errmsg | string | 错误信息 |





## iamadmin

**Des: **申请当前用户成为管理员

**URL:**`/iamadmin`

这个借口先占着，详细的之后再说。



## itemlist

### 接口说明

> 我们把所有能被预约的东西都称之为 `item` ，包括摄像机、29号楼房间等。

**Des: **获取物品预约信息。

**URL**：`/itemlist?p=<page>`

**Method: **GET

**Login?:** False

**请求参数**：

| 属性 | 类型 | 必填              | 说明                                       |
| ---- | ---- | ----------------- | ------------------------------------------ |
| p    | int  | 否，不填写默认为1 | 分页获取，避免一次性数据过多，每页20条数据 |

**返回值：**Json Object，其中包含：

| 属性       | 类型       | 说明                                         |
| ---------- | ---------- | -------------------------------------------- |
| code       | int        | 错误码                                       |
| errmsg     | string     | 错误信息                                     |
| item-count | int        | item的总个数                                 |
| page       | int        | 返回的是第几页                               |
| items      | Json Array | 包含`Item`对象，详见 [对象说明](#对象说明)。 |



## reserve

**URL:** `/reserve`

**Method: **POST

**Login?：**True，且需要事先绑定姓名学号。

**请求参数**：Json Object，属性如下：

| 属性    | 类型   | 必填 | 说明             |
| ------- | ------ | ---- | ---------------- |
| item-id | int32  | 是   | 要预约的Item的ID |
| rsv-req | Rsv    | 是   | 描述预约时段     |
| reason  | string | 否   | 申请原因         |

**返回值**：Json Object，属性如下：

| 属性   | 类型   | 说明     |
| ------ | ------ | -------- |
| code   | int    | 错误码   |
| errmsg | string | 错误信息 |
| rsv-id | int64  | 预约ID   |





# 对象说明

## Item对象

Item对象是一个Json Object对象，包含如下属性：

| 属性        | 类型        | 说明                                    |
| ----------- | ----------- | --------------------------------------- |
| name        | string      | 名字                                    |
| id          | int32       | 设备id                                  |
| brief-intro | string      | 简要介绍，小于50字符                    |
| thumbnail   | url, string | 缩略图的url                             |
| rsv-method  | RsvMethod   | 支持的预约方式                          |
| rsv-info    | Json Array  | 包含`Rsv`对象，记录的未来一周的预约信息 |



## Rsv对象

Rsv对象是一个Json Object，包含如下属性：

| 属性        | 类型      | 说明                             |
| ----------- | --------- | -------------------------------- |
| method      | RsvMethod | 使用的预约方法，保证只有一位为 1 |
| ...其他属性 |           |                                  |

还没想好长啥样，毕竟我们至少有两种支持的预约方式。。。



## RsvMethod对象

RsvMethod是一个32位的无符号整数（可以更长，但我觉得没必要），每一位是否为 1 代表是否支持对应的预约方法。现在存在的几种预约方法：

| 占用数据位 | 说明                                                         |
| ---------- | ------------------------------------------------------------ |
| 0          | 时间段预约，一次可预乐多个时间段。                           |
|            | 周一到周周五分为：早上(8-12)，中午(13-17)、晚上(17-24)       |
|            | 周末两天作为整体预约。                                       |
| 1          | 灵活预乐：预约某一天内某一个时间段，预约精确到分钟。         |
|            | 例如：`2021.7.18 8:30-22:35`含义为预约18号早上8点半到晚10：35。 |

如果一个RsvMethod值为 3，则意味着这个Item即可以按照时间段预约、又可以灵活预约，因为 `3 = 0b11`。如果为 2 ，则意味着只支持灵活预约。



