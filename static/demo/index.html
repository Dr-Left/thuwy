<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8" />
    <title>Upload测试站</title>
</head>

<body>
    <input id="file" type="file" />
    <button id="upload">上传</button>
    <div>上传结果：<a target="_blank" id="log" href="#">请先上传</a></div>
    <script>
        function Logger(text) {
            document.getElementById('log').innerText = text;
        }
        document.getElementById('upload').addEventListener('click', async () => {
            let file = document.getElementById('file').files[0];
            if (file === undefined) {
                Logger('文件不能为空');
                return;
            }
            try {
                let res = await fetch(`uploadurl/${file.name}`, {
                    method: 'GET'
                });
                var url = await res.text();
            } catch (e) {
                Logger('错误');
                throw (e);
            }
            if (url === undefined) {
                Logger('获取上传链接失败');
                return;
            }
            try {
                let res = await fetch(url, {
                    method: 'PUT',
                    body: file
                });
            } catch (e) {
                Logger('错误');
                throw (e);
            }
            url = url.split('?')[0];
            Logger(url);
            document.getElementById('log').href = url;
            document.getElementById('file').value = '';
        });
    </script>
</body>

</html>